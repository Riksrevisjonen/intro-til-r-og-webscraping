---
title: "Statistikk med R: løsningsforslag"
output: pdf_document
date: "`r format(Sys.Date(), '%e. %B %Y')`"
---

```{r setup, include=FALSE, error = TRUE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = sprintf('%s/course-material/statistikk-med-r/', here::here()))
```

### Oppgave 1: Les inn flatfiler

1. Les inn `carseats.csv` som varseats med `read.csv()`
2. Bruk `head(carseats)` for å se de første observasjonene
3. Bruk `sum()` og `mean()` for å finne sum og gjennomsnitt på variablene `Sales` og `Price`
4. Les inn fila på nytt, men bruk argumentet `stringsAsFactors` og sett dette til `TRUE`. Ser du en forskjell i hvordan fila er lest inn?


```{r}
carseats <- read.csv("carseats.csv")
str(carseats)
head(carseats)
sum(carseats$Sales)
sum(carseats[['Sales']])
sum(carseats[,1])

carseats <- read.csv("carseats.csv", stringsAsFactors = TRUE)
str(carseats)
class(carseats$ShelveLoc)
```

### Oppgave 2: Les inn Excel-filer

1. Last inn pakken `readxl` med `library(readxl)`
2. Les inn fila `carseats.xlsx` som `carseats_excel` med `read_xlsx` fra pakken `readxl`
3. Bruk `summary` på `carseats_excel`. Hva er median for variabelen `Price`?
4. Les inn fila `carseats.xlsx` på nytt, men kun med de 30 første radene med data og de 5 første kolonnene i Excel-fila

### Oppgave X: Lineær regresjon

1. Lag en regresjonsmodell med `Sales` som avhengig variabel. Inkluder _alle_ andre variabler som uavhengige variabler. Tilordne modellen til `car.mod1`
2. Hva er justert R<sup>2</sup> for modellen`?
3. Hvilke variabler i modellen er ikke signifikante?
4. Bygg en ny modell, enten med å bruke `lm()` på nytt, eller med `update()`, men uten variablene som ikke var signifikante (hint: husk at faktorvariabler håndteres på en spesiell måte i modeller). Tilordne modellen til `car.mod2`
5. Sammenlign F-statistikken og R<sup>2</sup> i den nye modellen med den gamle. Har modellen blitt bedre eller dårligere med de utelatte variablene?

```{r}
car.mod1 <- lm(Sales ~ ., data = carseats)
summary(car.mod1)
car.mod2 <- update(car.mod1, ~ . -Population -Education -Urban -US)
summary(car.mod2)
```

### Oppgave X: Logistisk regresjon

```{r}
Weekly <- ISLR::Weekly
head(Weekly)
glm.mod <- glm(
  Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume,
  data = Weekly,
  family = binomial
)
summary(glm(Direction ~ Lag2, data = Weekly, family = binomial))
glm.preds <- factor(ifelse(predict(glm.mod, Weekly, type = 'response') > .5, 'Up', 'Down'))
table(glm.preds, Weekly$Direction)
```


### Oppgave X: Predict

```{r}
set.seed(42)
x <- runif(nrow(carseats), 0, 1) < .7
car.train <- carseats[x,]
car.test <- carseats[!x,]
train.mod <- lm(Sales ~ CompPrice + Advertising + Price + ShelveLoc, data = car.train)
train.pred <- predict(train.mod, car.train)
err <- train.pred - car.train$Sales
sqrt(mean(err^2))
test.pred <- predict(train.mod, car.test)
err <- test.pred - car.test$Sales
sqrt(mean(err^2))
```

